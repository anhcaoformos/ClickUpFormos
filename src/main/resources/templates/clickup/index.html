<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Title</title>
    <style type="text/css" xml:space="preserve">
      body {
        font-family: -apple-system, BlinkMacSystemFont, Segoe UI, roboto, Helvetica Neue, helvetica, arial, sans-serif;
        font-size: 13px;
      }
      .task_body {
        border: 1px solid #e9ebf0;
        border-radius: 8px;
        padding-left: 10px;
      }
      .task_image {
        width: 100%;
        height: auto;
      }
      .comment_body {
        border: 1px solid #e9ebf0;
        border-radius: 8px;
        padding-left: 10px;
      }
      .comment_container {
        border: 2px solid #e9ebf0;
        border-radius: 8px;
        margin-bottom: 30px;
        padding-left: 20px;
      }
      .comment_image {
        width: 160px;
        height: 100px;
      }
      .comment_child {
        margin-left: 40px;
        margin-bottom: 10px;
      }
      .attachment_body {
        border: 1px solid #e9ebf0;
        border-radius: 8px;
      }
      .attachment_image {
        width: 200px;
        height: auto;
        max-width: 100%;
      }
      .attachment_grid {
        justify-content: center;
        display: table;
        border-radius: 8px;
        border: 1px solid #e9ebf0;
        padding-left: 35px;
      }
      .attachment_item {
        height: 160px;
        display: -webkit-box; /* wkhtmltopdf uses this one */
        display: flex;
        -webkit-box-pack: center; /* wkhtmltopdf uses this one */
        justify-content: center;
        -webkit-box-align: center;
      }
      .attachment_card {
        border-radius: 8px;
        border: 1px solid #e9ebf0;
        break-inside: avoid;
        margin-bottom: 10px;
        float: left;
        width: 24%;
      }
      .attachment_title {
        text-align: center;
      }
      .row {
        display: -webkit-box; /* wkhtmltopdf uses this one */
        display: flex;
        -webkit-box-pack: justify; /* wkhtmltopdf uses this one */
        justify-content: space-between;
        align-items: center;
        margin: 10px;
      }
      .comment_title {
        display: -webkit-box; /* wkhtmltopdf uses this one */
        display: flex;
        -webkit-box-pack: start; /* wkhtmltopdf uses this one */
        justify-content: start;
        -webkit-box-align: center;
      }
      .user_img {
        border-radius: 50%;
        display: -webkit-box; /* wkhtmltopdf uses this one */
        display: flex;
        -webkit-box-pack: center; /* wkhtmltopdf uses this one */
        justify-content: center;
        -webkit-box-align: center;
        width: 20px;
        height: 20px;
        margin-right: 10px;
        font-size: 10px;
      }
      .separate_parent_children {
        margin-top: 10px;
      }
      .pre-wrap {
        white-space: pre-wrap;
      }
      .page_break_inside {
        page-break-inside: avoid !important;
      }
      .block_image {
        display: block;
      }
      .block_image_attachment {
        display: -webkit-box;
        -webkit-box-pack: center; /* wkhtmltopdf uses this one */
        justify-content: center;
        -webkit-box-align: center;
      }
      .code {
        border: 1px solid #e4e4e4;
        background: #f7f7f7;
        border-radius: 2px;
        white-space: pre-wrap;
        padding: 2px 4px;
        line-height: 1;
        font-size: 100% !important;
        color: #d16464 !important;
      }
      .quote {
        font-style: italic;
        padding-left: 15px;
        margin-top: 10px;
        margin-bottom: 10px;
        border-inline-start: 4px solid #d6d9de;
        border-left: 2px solid #d6d9de;
      }
      .emoji {
        height: 1em;
        width: 1em;
        margin: 0 0.05em 0 0.1em;
        vertical-align: -0.1em;
      }
      .banner {
        margin-top: 10px;
        margin-bottom: 10px;
        padding-left: 40px;
      }
      .status {
        border-radius: 3px;
        border: 1px;
        padding: 0 3px 0 3px;
      }
      table {
        border-collapse: collapse;
      }
      table tr td {
        border: 1px solid;
        padding: 5px 10px;
      }
    </style>
    <script src="https://twemoji.maxcdn.com/v/latest/twemoji.min.js"></script>
    <script>
      window.onload = function () {
        twemoji.parse(document.body);
      };
    </script>
  </head>
  <body>
    <div>
      <div id="task">
        <h3>Task:</h3>
        <div class="task_body">
          <div class="row">
            <div>
              <h4 th:utext="${task.getName()}"></h4>
            </div>
            <div class="status" th:style="${'background-color: ' + task.getStatusColor()}" th:text="${task.getStatus()}"></div>
          </div>
          <div>
            <p th:utext="${task.getDescription()}"></p>
          </div>
        </div>
      </div>
      <div id="attachments" th:if="${not #sets.isEmpty(task.getAttachments())}">
        <h3>Attachments:</h3>
        <div class="attachment_body page_break_inside">
          <div class="attachment_grid">
            <div class="attachment_card" th:each="attachment : ${task.getAttachments()}">
              <div class="attachment_item">
                <a th:if="${not attachment.isImage()}" th:href="${attachment.getId()}" th:text="${attachment.getTitle()}"></a>
                <a class="block_image_attachment" th:if="${attachment.isImage()}" th:href="${attachment.getId()}">
                  <img class="attachment_image page_break_inside" th:src="${task.getBaseImagePath() + '\\' + attachment.getId()}" />
                </a>
              </div>
              <h6 class="attachment_title" th:text="${attachment.getDateTime()}"></h6>
            </div>
          </div>
        </div>
      </div>
      <div id="comments">
        <h3>Comments:</h3>
        <div th:each="comment : ${task.getComments()}" class="comment_container page_break_inside">
          <div class="comment_title">
            <div
              class="user_img"
              th:text="${comment.getUser().getInitials()}"
              th:style="'background:' + ${comment.getUser().getColor()}"
            ></div>
            <div><h5 th:text="|${comment.getUsername()}  (${comment.getDateTime()})|"></h5></div>
          </div>
          <div class="comment_body">
            <div th:utext="${comment.getHtmlText()}"></div>
            <div class="row" th:if="${comment.getResolved() != null}">
              <div class="comment_title">
                <div
                  class="user_img"
                  th:text="${comment.getAssignee().getInitials()}"
                  th:style="'background:' + ${comment.getAssignee().getColor()}"
                ></div>
                <div>
                  <span
                    th:if="${comment.getAssignee().getUsername() != null}"
                    th:text="|Assignee: ${comment.getAssignee().getUsername()}"
                    |
                  ></span>
                </div>
              </div>
              <div class="comment_title">
                <div
                  class="user_img"
                  th:text="${comment.getAssignedBy().getInitials()}"
                  th:style="'background:' + ${comment.getAssignedBy().getColor()}"
                ></div>
                <div>
                  <span
                    th:if="${comment.getAssignedBy().getUsername() != null}"
                    th:text="|Assigned By: ${comment.getAssignedBy().getUsername()}|"
                  ></span>
                </div>
              </div>
              <div class="comment_title">
                <div
                  class="user_img"
                  th:text="${comment.getResolvedBy().getInitials()}"
                  th:style="'background:' + ${comment.getResolvedBy().getColor()}"
                ></div>
                <div>
                  <span
                    th:if="${comment.getResolvedBy().getUsername() != null}"
                    th:text="|Resolved By: ${comment.getResolvedBy().getUsername()}|"
                  ></span>
                </div>
              </div>
            </div>
          </div>
          <div th:if="${not #lists.isEmpty(comment.getChildren())}" class="separate_parent_children"></div>
          <div
            class="comment_body comment_child page_break_inside"
            th:if="${not #lists.isEmpty(comment.getChildren())}"
            th:each="child : ${comment.getChildren()}"
          >
            <div class="comment_title">
              <div
                class="user_img"
                th:text="${child.getUser().getInitials()}"
                th:style="'background:' + ${child.getUser().getColor()}"
              ></div>
              <div><h6 th:text="|${child.getUsername()}  (${child.getDateTime()})|"></h6></div>
            </div>
            <div>
              <div th:utext="${child.getHtmlText()}"></div>
              <div class="row" th:if="${child.getResolved() != null}">
                <div class="comment_title">
                  <div
                    class="user_img"
                    th:text="${child.getAssignee().getInitials()}"
                    th:style="'background:' + ${child.getAssignee().getColor()}"
                  ></div>
                  <div>
                    <span
                      th:if="${child.getAssignee().getUsername() != null}"
                      th:text="|Assignee: ${child.getAssignee().getUsername()}|"
                    ></span>
                  </div>
                </div>
                <div class="comment_title">
                  <div
                    class="user_img"
                    th:text="${child.getAssignedBy().getInitials()}"
                    th:style="'background:' + ${child.getAssignedBy().getColor()}"
                  ></div>
                  <div>
                    <span
                      th:if="${child.getAssignedBy().getUsername() != null}"
                      th:text="|Assigned By: ${child.getAssignedBy().getUsername()}|"
                    ></span>
                  </div>
                </div>
                <div class="comment_title">
                  <div
                    class="user_img"
                    th:text="${child.getResolvedBy().getInitials()}"
                    th:style="'background:' + ${child.getResolvedBy().getColor()}"
                  ></div>
                  <div>
                    <span
                      th:if="${child.getResolvedBy().getUsername() != null}"
                      th:text="|Resolved By: ${child.getResolvedBy().getUsername()}|"
                    ></span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
